# ピラティス予約システムの会員追加情報管理に関する実装方針まとめ

## 1. 全体方針

-   **戦略名**: アプリケーション内での一元管理
-   **概要**: Next.jsで自作中の予約システム内で、会員の基本情報と追加情報の両方を収集・管理します。外部サービス（Googleフォーム等）は利用しません。
-   **ユーザーフロー**:
    1.  顧客は、会員登録後にマイページで追加情報（ピラティス経験、来店きっかけ等）を入力します。
    2.  運営は、管理者ダッシュボードで全会員の情報を閲覧し、分析に活用します。

## 2. 顧客側の実装（データ入力）

-   **対象ページ**: マイページ (`My Page`) / プロフィール編集画面
-   **実装内容**:
    -   **入力フォームの設置**
        -   ピラティス経験、疾患の有無、来店きっかけ等の追加情報を入力・更新できるフォームを作成します。
        -   UIの提案として、ラジオボタン、チェックボックス、テキストエリアを適切に使い分け、ユーザーの入力負担を軽減します。
    -   **入力促進の仕組み**
        -   ユーザーに入力を促すための工夫を実装します。
        -   **具体的な方法**:
            -   初回ログイン時にモーダルウィンドウでフォームへ誘導する。
            -   マイページ上に「プロフィールを完成させましょう」といった未入力項目への案内を常時表示する。

## 3. 運営側の実装（データ閲覧・分析）

-   **対象ページ**: 管理者ダッシュボード (`Admin Dashboard`)
-   **統合箇所**: 既存の「統計分析」セクションに、会員属性に関する分析機能を追加します。
-   **実装内容**:
    -   **会員情報の一覧・詳細表示機能**
        -   管理したい全項目（氏名、住所、ピラティス経験など）を網羅した会員データベースを構築します。
        -   **主な機能**:
            -   会員一覧テーブルの表示
            -   検索、ソート、フィルタリング機能によるデータの絞り込み
            -   スタッフによるデータの手動編集（CRUD）機能
    -   **会員属性の分析機能（統計分析セクションに追加）**
        -   収集した会員データを集計・可視化し、既存の予約数分析などと並べて表示します。
        -   **分析例**:
            -   住所データに基づく顧客分布（例：「●市△区」からの来客数ランキング）
            -   来店きっかけ（集客チャネル）の割合を円グラフで表示
            -   ピラティス経験の有無によるグループ分けと人数集計
    -   **データエクスポート機能**
        -   分析結果や会員リスト全体をCSVファイルとしてダウンロードできる機能を用意し、Excel等での二次加工に対応します。

## 4. バックエンド・データベース設計

-   **データベーススキーマ**
    -   **対象テーブル**: `users` または `profiles`
    -   **変更内容**: 収集したい追加情報（`pilates_experience`, `motivation`, `medical_history`等）に対応するカラムを追加します。カラムは`NULL`を許容する設定にします。
-   **APIエンドポイント**
    -   **顧客用プロフィール更新API**
        -   **Path**: `/api/profile/update`
        -   **Method**: `POST` / `PUT`
        -   **Description**: 顧客がマイページから自身の追加情報を送信・更新するためのAPI。
    -   **管理者用 会員リスト取得API**
        -   **Path**: `/api/admin/users`
        -   **Method**: `GET`
        -   **Description**: 管理者ダッシュボードで全会員のリストを取得するためのAPI。
    -   **管理者用 会員情報更新API**
        -   **Path**: `/api/admin/users/[id]`
        -   **Method**: `PUT` / `DELETE`
        -   **Description**: 管理者が特定の会員情報を更新・削除するためのAPI。